<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†æ¨¡å¼ä¿®å¤æµ‹è¯•</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { padding: 20px; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid var(--border-color, #dee2e6);
            border-radius: 5px;
        }
        .test-button {
            background: var(--primary-color, #2d5a4f);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>ç®¡ç†æ¨¡å¼ä¿®å¤æµ‹è¯•</h1>

    <div class="test-section">
        <h3>æµ‹è¯•1: ç‚¹å‡»æŒ‰é’®åˆ‡æ¢ç®¡ç†æ¨¡å¼</h3>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ç®¡ç†æ¨¡å¼åˆ‡æ¢ï¼Œè§‚å¯Ÿå¯¼èˆªé¡¹çš„æ–‡æœ¬æ˜¯å¦ä¿æŒå¯è§ï¼š</p>
        <button class="test-button" onclick="toggleManageMode()">åˆ‡æ¢ç®¡ç†æ¨¡å¼</button>
        <button class="test-button" onclick="testWithSampleData()">ä½¿ç”¨ç¤ºä¾‹æ•°æ®æµ‹è¯•</button>
    </div>

    <div class="sidebar" id="testSidebar">
        <h3>å¯¼èˆªæµ‹è¯•</h3>
        <div id="navTree">
            <!-- å¯¼èˆªé¡¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
        </div>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•ç»“æœ</h3>
        <div id="testResult">
            <p>ç­‰å¾…æµ‹è¯•...</p>
        </div>
    </div>

    <script>
        let isManageMode = false;
        let testBookmarks = [
            {
                category: 'æµ‹è¯•åˆ†ç±»1',
                subcategories: [
                    {
                        name: 'å­åˆ†ç±»1',
                        icon: 'fas fa-folder',
                        items: [
                            { title: 'æµ‹è¯•é“¾æ¥1', url: '#', description: 'æµ‹è¯•æè¿°1' },
                            { title: 'æµ‹è¯•é“¾æ¥2', url: '#', description: 'æµ‹è¯•æè¿°2' }
                        ]
                    }
                ]
            },
            {
                category: 'æµ‹è¯•åˆ†ç±»2',
                subcategories: [
                    {
                        name: 'å­åˆ†ç±»2',
                        icon: 'fas fa-folder',
                        items: [
                            { title: 'æµ‹è¯•é“¾æ¥3', url: '#', description: 'æµ‹è¯•æè¿°3' }
                        ]
                    }
                ]
            }
        ];

        function renderNavTree() {
            const navTree = document.getElementById('navTree');
            navTree.innerHTML = '';

            testBookmarks.forEach((category, index) => {
                const totalItems = category.subcategories.reduce((sum, sub) => sum + sub.items.length, 0);

                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.setAttribute('data-category-index', index);
                navItem.innerHTML = `
                    <a href="#" class="nav-link" data-category="${index}">
                        <i class="nav-icon fas fa-folder"></i>
                        <span class="nav-text">${category.category}</span>
                        <span class="nav-count">${totalItems}</span>
                        <button class="nav-toggle">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        ${isManageMode ? `<button class="nav-manage-btn" data-type="category" data-category="${index}"><i class="fas fa-ellipsis-v"></i></button>` : ''}
                    </a>
                    <div class="nav-submenu">
                        ${category.subcategories.map((sub, subIndex) => `
                            <div class="nav-item">
                                <a href="#" class="nav-link" data-category="${index}" data-subcategory="${subIndex}">
                                    <i class="nav-icon ${sub.icon}"></i>
                                    <span class="nav-text">${sub.name}</span>
                                    <span class="nav-count">${sub.items.length}</span>
                                    ${isManageMode ? `<button class="nav-manage-btn" data-type="subcategory" data-category="${index}" data-subcategory="${subIndex}"><i class="fas fa-ellipsis-v"></i></button>` : ''}
                                </a>
                            </div>
                        `).join('')}
                    </div>
                `;
                navTree.appendChild(navItem);
            });
        }

        function toggleManageMode() {
            isManageMode = !isManageMode;
            const body = document.body;

            if (isManageMode) {
                body.classList.add('manage-mode');
            } else {
                body.classList.remove('manage-mode');
            }

            // é‡æ–°æ¸²æŸ“
            renderNavTree();

            // æµ‹è¯•æ–‡æœ¬å¯è§æ€§
            testTextVisibility();
        }

        function testTextVisibility() {
            const navTexts = document.querySelectorAll('.nav-text');
            let visibleCount = 0;
            let hiddenCount = 0;

            navTexts.forEach((element, index) => {
                const styles = getComputedStyle(element);
                const isVisible = styles.display !== 'none' &&
                               styles.visibility !== 'hidden' &&
                               parseFloat(styles.opacity) > 0;

                if (isVisible) {
                    visibleCount++;
                } else {
                    hiddenCount++;
                }

                console.log(`Text ${index} (${element.textContent}):`, {
                    display: styles.display,
                    visibility: styles.visibility,
                    opacity: styles.opacity,
                    color: styles.color,
                    isVisible: isVisible
                });
            });

            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = `
                <p><strong>æµ‹è¯•ç»“æœï¼š</strong></p>
                <p>âœ… å¯è§çš„æ–‡æœ¬: ${visibleCount} ä¸ª</p>
                <p>âŒ éšè—çš„æ–‡æœ¬: ${hiddenCount} ä¸ª</p>
                <p>ğŸ“Š ç®¡ç†æ¨¡å¼: ${isManageMode ? 'å¼€å¯' : 'å…³é—­'}</p>
                <p>ğŸ¯ çŠ¶æ€: ${hiddenCount === 0 ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</p>
            `;
        }

        function testWithSampleData() {
            renderNavTree();
            testTextVisibility();
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderNavTree();
            setTimeout(testTextVisibility, 100);
        });
    </script>
</body>
</html>