<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½ä¿®å¤æµ‹è¯• - AgricultureModeling</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        iframe { width: 100%; height: 600px; border: 1px solid #ccc; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ AgricultureModeling åŠŸèƒ½ä¿®å¤æµ‹è¯•</h1>

    <div class="test-section">
        <h2>ğŸ“ ä¿®å¤æ¸…å•</h2>
        <div class="test-result success">âœ… 1. ä¿®å¤é¡µé¢æ˜¾ç¤º 'loading=lazy' æ–‡å­—é—®é¢˜</div>
        <div class="test-result success">âœ… 2. ä¿®å¤å·¦ä¾§å¯¼èˆªå±•å¼€/æ”¶èµ·åŠŸèƒ½</div>
        <div class="test-result success">âœ… 3. æ£€æŸ¥å¹¶è¡¥å…¨ bookmarks.json æ•°æ®</div>
        <div class="test-result success">âœ… 4. ä¼˜åŒ–å³ä¾§å†…å®¹æ˜¾ç¤ºé€»è¾‘</div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        <div id="testResults">
            <div class="test-result info">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>
        <button class="btn-primary" onclick="runDataTest()">æµ‹è¯•æ•°æ®å®Œæ•´æ€§</button>
        <button class="btn-primary" onclick="runStructureTest()">æµ‹è¯•å¯¼èˆªç»“æ„</button>
        <button class="btn-success" onclick="openMainSite()">ğŸš€ æ‰“å¼€ä¸»ç½‘ç«™</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡</h2>
        <div id="dataStats">
            <div class="test-result info">åŠ è½½æ•°æ®ç»Ÿè®¡ä¸­...</div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ–¥ï¸ ç½‘ç«™é¢„è§ˆ</h2>
        <iframe src="./index.html" title="AgricultureModeling ç½‘ç«™é¢„è§ˆ"></iframe>
    </div>

    <script>
        let bookmarksData = null;

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ•°æ®ç»Ÿè®¡
        document.addEventListener('DOMContentLoaded', function() {
            loadDataStats();
        });

        async function loadDataStats() {
            try {
                const response = await fetch('./data/bookmarks.json');
                bookmarksData = await response.json();

                if (bookmarksData) {
                    displayDataStats();
                }
            } catch (error) {
                document.getElementById('dataStats').innerHTML =
                    `<div class="test-result error">æ•°æ®åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        function displayDataStats() {
            let totalCategories = bookmarksData.length;
            let totalSubcategories = 0;
            let totalLinks = 0;
            let emptyCategories = [];

            bookmarksData.forEach((category, index) => {
                if (category.subcategories) {
                    totalSubcategories += category.subcategories.length;

                    category.subcategories.forEach(subcategory => {
                        if (subcategory.links) {
                            totalLinks += subcategory.links.length;
                        }

                        if (!subcategory.links || subcategory.links.length === 0) {
                            emptyCategories.push(`${category.title} > ${subcategory.title}`);
                        }
                    });
                }
            });

            let statsHTML = `
                <div class="test-result success">
                    ğŸ“Š <strong>æ•°æ®ç»Ÿè®¡</strong><br>
                    â€¢ ä¸»åˆ†ç±»: ${totalCategories} ä¸ª<br>
                    â€¢ å­åˆ†ç±»: ${totalSubcategories} ä¸ª<br>
                    â€¢ ä¹¦ç­¾é“¾æ¥: ${totalLinks} ä¸ª
                </div>
            `;

            if (emptyCategories.length > 0) {
                statsHTML += `
                    <div class="test-result warning">
                        ğŸ“‹ <strong>ç©ºåˆ†ç±» (${emptyCategories.length} ä¸ª)</strong><br>
                        ${emptyCategories.map(cat => `â€¢ ${cat}`).join('<br>')}
                    </div>
                `;
            }

            document.getElementById('dataStats').innerHTML = statsHTML;
        }

        async function runDataTest() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="test-result info">æ­£åœ¨æµ‹è¯•æ•°æ®å®Œæ•´æ€§...</div>';

            try {
                if (!bookmarksData) {
                    await loadDataStats();
                }

                let testHTML = '';

                // æµ‹è¯•1: æ•°æ®ç»“æ„
                if (Array.isArray(bookmarksData) && bookmarksData.length > 0) {
                    testHTML += '<div class="test-result success">âœ“ æ•°æ®ç»“æ„æ­£ç¡®</div>';
                } else {
                    testHTML += '<div class="test-result error">âœ— æ•°æ®ç»“æ„å¼‚å¸¸</div>';
                }

                // æµ‹è¯•2: å¿…éœ€å­—æ®µ
                let structureValid = true;
                bookmarksData.forEach((category, index) => {
                    if (!category.title || !category.subcategories) {
                        structureValid = false;
                    }
                });

                if (structureValid) {
                    testHTML += '<div class="test-result success">âœ“ æ‰€æœ‰åˆ†ç±»åŒ…å«å¿…éœ€å­—æ®µ</div>';
                } else {
                    testHTML += '<div class="test-result error">âœ— éƒ¨åˆ†åˆ†ç±»ç¼ºå°‘å¿…éœ€å­—æ®µ</div>';
                }

                // æµ‹è¯•3: é“¾æ¥æœ‰æ•ˆæ€§æ£€æŸ¥
                let linkCount = 0;
                let validLinks = 0;

                for (let category of bookmarksData) {
                    if (category.subcategories) {
                        for (let subcategory of category.subcategories) {
                            if (subcategory.links) {
                                linkCount += subcategory.links.length;
                                subcategory.links.forEach(link => {
                                    if (link.url && link.title) {
                                        validLinks++;
                                    }
                                });
                            }
                        }
                    }
                }

                testHTML += `<div class="test-result success">âœ“ æœ‰æ•ˆé“¾æ¥: ${validLinks}/${linkCount}</div>`;

                results.innerHTML = testHTML;

            } catch (error) {
                results.innerHTML = `<div class="test-result error">æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        async function runStructureTest() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="test-result info">æ­£åœ¨æµ‹è¯•å¯¼èˆªç»“æ„...</div>';

            try {
                // æµ‹è¯•å¯¼èˆªæ ‘ç”Ÿæˆ
                let testHTML = '';

                if (bookmarksData && bookmarksData.length > 0) {
                    testHTML += '<div class="test-result success">âœ“ å¯¼èˆªæ•°æ®å¯ç”¨</div>';

                    // æ£€æŸ¥æ¯ä¸ªåˆ†ç±»çš„å›¾æ ‡
                    let hasIcons = true;
                    bookmarksData.forEach(category => {
                        if (category.subcategories) {
                            category.subcategories.forEach(sub => {
                                if (!sub.icon) {
                                    hasIcons = false;
                                }
                            });
                        }
                    });

                    if (hasIcons) {
                        testHTML += '<div class="test-result success">âœ“ æ‰€æœ‰å­åˆ†ç±»éƒ½æœ‰å›¾æ ‡</div>';
                    } else {
                        testHTML += '<div class="test-result warning">âš  éƒ¨åˆ†å­åˆ†ç±»ç¼ºå°‘å›¾æ ‡</div>';
                    }

                    // æ£€æŸ¥åˆ†ç±»å±‚çº§
                    let maxDepth = 0;
                    bookmarksData.forEach(category => {
                        if (category.subcategories && category.subcategories.length > 0) {
                            maxDepth = Math.max(maxDepth, 2); // ä¸»åˆ†ç±» + å­åˆ†ç±»
                        }
                    });

                    testHTML += `<div class="test-result info">ğŸ“Š å¯¼èˆªå±‚çº§æ·±åº¦: ${maxDepth}</div>`;
                }

                results.innerHTML = testHTML;

            } catch (error) {
                results.innerHTML = `<div class="test-result error">æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        function openMainSite() {
            window.open('./index.html', '_blank');
        }
    </script>
</body>
</html>